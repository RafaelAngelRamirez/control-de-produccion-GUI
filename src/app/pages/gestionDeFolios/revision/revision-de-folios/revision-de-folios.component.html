<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <a
          class="btn btn-primary btn-sm  mr-3"
          data-toggle="collapse"
          href="#grupoDeFiltroId"
          aria-expanded="false"
          aria-controls="grupoDeFiltroId"
        >
          Mostrar filtros
        </a>

        <a
          (click)="cambiarVerComoPedidos(!verComoPedidos)"
          class="btn btn-warning btn-sm mr-3 "
          aria-expanded="false"
          aria-controls="grupoDeFiltroId"
        >
          <ng-container *ngIf="verComoPedidos; else verComoPedidosTemplate">
            Ver como folios
          </ng-container>
          <ng-template #verComoPedidosTemplate>
            Ver como pedidos
          </ng-template>
        </a>

        <a (click)="this.cargarFolios()" class="btn btn-secondary btn-sm ">
          <i
            *ngIf="actualizarVista || cargando"
            class="fas fa-sync fa-spin"
          ></i>
          Actualizar</a
        >
      </div>
    </div>
  </div>
</div>

<div class="collapse" id="grupoDeFiltroId">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <app-grupo-de-filtro
            (obtenerEsteComponente)="this.componenteFiltrador = $event"
            (obtenerFiltros)="aplicarFiltros($event)"
          >
          </app-grupo-de-filtro>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="folios.length === 0 && !cargando" class="row animated fadeIn">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h1 class="display-1 ">
          No hay <strong>folios</strong> pendientes de revision
        </h1>
      </div>
    </div>
  </div>
</div>

<div *ngIf="cargando" class="row animated fadeIn">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h1 class="display-1 ">
          <tr *ngIf="cargando">
            <td colspan="20">
              <h1 class="display-1">
                <i class="fas fa-sync fa-spin"></i>
              </h1>

              <h3>Aplicando cambios, espere...</h3>
            </td>
          </tr>
        </h1>
      </div>
    </div>
  </div>
</div>

<div *ngIf="folios.length > 0" class="row animated fadeIn faster">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <app-paginador *ngIf="folios" [paginador]="_paginadorService">
        </app-paginador>

        <table class="table table-hover">
          <thead>
            <tr *ngIf="folios">
              <th></th>
              <!-- <th title='Ver detalle rapido del folio.'><i class="fas fa-question-circle    "></i></th>
                            <th title='Revisar a fondo el folio y si es necesario alterar funciones basicas.'> <i class="fas fa-question-circle    "></i></th> -->
              <th class="no-wrap" title="Numero consecutivo del folio.">
                <i class="fas fa-question-circle    "></i> FOL
              </th>
              <th
                *ngIf="verComoPedidos"
                class="no-wrap"
                title="Numero de pedido."
              >
                <i class="fas fa-question-circle    "></i> PED
              </th>
              <th class="no-wrap" title="El cliente.">
                <i class="fas fa-question-circle    "></i> CLI
              </th>
              <th
                class="no-wrap"
                title="El vendedor al cual pertenece el folio."
              >
                <i class="fas fa-question-circle    "></i> VEN
              </th>
              <th
                *ngIf="verComoPedidos"
                class="no-wrap"
                title="El modelo completo"
              >
                <i class="fas fa-question-circle    "></i> MOD
              </th>
              <th
                class="no-wrap"
                title="Fecha de entrega a produccion. Es la fecha en que el vendedor finaliza las modificaciones a su folio y lo entrega a produccion."
              >
                <i class="fas fa-question-circle    "></i> FEP
              </th>
              <th
                class="no-wrap"
                title="La sumatoria de todas las piezas de todos los pedidos del folio"
              >
                <i class="fas fa-question-circle    "></i> TPZ
              </th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="folios">
              <ng-container *ngFor="let folio of folios; trackBy: customTB">
                <tr
                  *ngFor="
                    let pedido of verComoPedidos
                      ? folio.folioLineas
                      : [folio.folioLineas]
                  "
                >
                  <td class="fit">
                    <a
                      *ngIf="!verComoPedidos"
                      (click)="folioParaDetalle = folio"
                      title="Ver detalle rapido del folio."
                      data-toggle="modal"
                      data-target="#detalleFolio"
                      name=""
                      id=""
                      class="btn btn-primary text-white btn-sm mr-2"
                      role="button"
                    >
                      <i class="fas fa-eye    "></i
                    ></a>

                    <a
                      *ngIf="verComoPedidos"
                      (click)="pedidoParaDetalle = pedido"
                      title="Ver detalle rapido del pedido."
                      data-toggle="modal"
                      data-target="#detalleDePedido"
                      name=""
                      id=""
                      class="btn btn-primary text-white btn-sm mr-2"
                      role="button"
                    >
                      <i class="fas fa-eye    "></i
                    ></a>

                    <a
                      *ngIf="!verComoPedidos"
                      (click)="retornarControlDeFolioAVendedor(folio)"
                      title="Retornar control a vendedor. Esto elimina la fecha de entrega a produccion y hace que el vendedor pueda modificar de nuevo el folio."
                      name=""
                      id=""
                      class="btn btn-warning text-dark btn-sm "
                      role="button"
                    >
                      <i class="fas fa-arrow-left "></i
                    ></a>
                  </td>
                  <td class="fit">{{ folio.numeroDeFolio }}</td>
                  <td *ngIf="verComoPedidos" class="fit">
                    {{ pedido.pedido }}
                  </td>
                  <td>{{ folio.cliente.nombre }}</td>
                  <td>{{ folio.vendedor.nombre }}</td>
                  <td *ngIf="verComoPedidos" class="fit">
                    {{ pedido.modeloCompleto | modeloCompleto }}
                  </td>
                  <td
                    title="{{
                      folio.fechaDeEntregaAProduccion | fecha: 'LLLL'
                    }}"
                  >
                    <i class="fas fa-clock-o"></i>
                    {{ folio.fechaDeEntregaAProduccion | date: 'dd/MM/y' }}
                  </td>
                  <td>
                    <ng-container *ngIf="verComoPedidos; else elseTemplate">
                      {{ pedido.cantidad | number }}
                    </ng-container>
                    <ng-template #elseTemplate>
                      {{ folio.totalDePiezas() | number }}
                    </ng-template>
                  </td>
                  <td class="fit">
                    <button
                      (click)="generarOrdenesDelFolio(folio)"
                      title="Generar las ordenes de este folio"
                      data-toggle="modal"
                      data-target="#modalFolioOrdenesRevision"
                      type="button"
                      class="btn btn-outline-warning btn-sm"
                    >
                      <i class="fas fa-list-alt"></i>
                    </button>
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </tbody>
        </table>

        <app-paginador *ngIf="folios" [paginador]="_paginadorService">
        </app-paginador>
      </div>
    </div>
  </div>
</div>

<!-- 
=====================================
 MODAL FOLIO DETALLE
=====================================
-->

<app-folios-detalle-abstracto
  *ngIf="folioParaDetalle"
  (pedido)="pedidoParaDetalle = $event"
  [folio]="folioParaDetalle"
></app-folios-detalle-abstracto>

<!-- 
=====================================
 END MODAL FOLIO DETALLE
=====================================
-->

<!-- 
=====================================
 MODAL FOLIO REVISION DE ORDENES
=====================================
-->

<div
  class="modal fade"
  id="modalFolioOrdenesRevision"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-revision-de-ordenes-abstracto
          [folio]="folioParaGenerarOrdenes"
          (guardar)="generarOrdenes($event)"
          (esteComponente)="revisionDeOrdenesCargarComponente($event)"
          (pedidoASurtirOLaserar)="inicializarSurtidoOLaserado($event)"
        ></app-revision-de-ordenes-abstracto>
      </div>
    </div>
  </div>
</div>

<!-- 
=====================================
 END MODAL FOLIO REVISION DE ORDENES
=====================================
-->

<!-- 
=====================================
 Modal surtir desde almacen o laserar
=====================================
-->

<!-- Modal -->
<div
  class="modal fade"
  id="modalModeloCompletoGestorDeProcesosEspeciales"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-modelo-completo-gestor-de-procesos-especiales
          (esteComponente)="procesosEspeciales($event)"
          [debug]="true"
          [pedido]="pedidoParaSurtirOLaserar"
        >
        </app-modelo-completo-gestor-de-procesos-especiales>
      </div>
    </div>
  </div>
</div>

<!-- 
=====================================
 END Modal surtir desde almacen o laserar
=====================================
-->
