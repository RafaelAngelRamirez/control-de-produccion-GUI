<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <a
          class="btn btn-primary btn-sm  mr-3"
          data-toggle="collapse"
          href="#grupoDeFiltroId"
          aria-expanded="false"
          aria-controls="grupoDeFiltroId"
        >
          Mostrar filtros
        </a>

        <a
          (click)="cambiarVerComoPedidos(!verComoPedidos)"
          class="btn btn-warning btn-sm mr-3 "
          aria-expanded="false"
          aria-controls="grupoDeFiltroId"
        >
          <ng-container *ngIf="verComoPedidos; else verComoPedidosTemplate">
            Ver como folios
          </ng-container>
          <ng-template #verComoPedidosTemplate>
            Ver como pedidos
          </ng-template>
        </a>

        <a (click)="this.cargarFolios()" class="btn btn-secondary btn-sm ">
          <i
            class="fas fa-refresh fa-spin"
            [ngClass]="{ 'fa-spin': actualizarVista }"
          ></i>
          Actualizar</a
        >
      </div>
    </div>
  </div>
</div>

<div class="collapse" id="grupoDeFiltroId">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <app-grupo-de-filtro
            (obtenerEsteComponente)="this.componenteFiltrador = $event"
            (obtenerFiltros)="aplicarFiltros($event)"
          >
          </app-grupo-de-filtro>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="folios.length === 0" class="row animated fadeIn">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h1 class="display-1 ">No hay <strong>folios</strong> para mostrar</h1>
      </div>
    </div>
  </div>
</div>

<div *ngIf="folios.length > 0" class="row animated fadeIn faster">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <app-paginador *ngIf="folios" [paginador]="_paginadorService">
        </app-paginador>

        <table class="table table-hover">
          <thead>
            <tr *ngIf="folios">
              <th></th>
              <!-- <th title='Ver detalle rapido del folio.'><i class="fas fa-question-circle    "></i></th>
                            <th title='Revisar a fondo el folio y si es necesario alterar funciones basicas.'> <i class="fas fa-question-circle    "></i></th> -->
              <th title="Numero consecutivo del folio.">FOL</th>
              <th *ngIf="verComoPedidos" title="Numero de pedido.">PED</th>
              <th title="El cliente.">CLI</th>
              <th title="El vendedor al cual pertenece el folio.">VEN</th>
              <th *ngIf="verComoPedidos" title="El modelo completo">MOD</th>
              <th
                title="Fecha de entrega a produccion. Es la fecha en que el vendedor finaliza las modificaciones a su folio y lo entrega a produccion."
              >
                FEP
              </th>
              <th
                title="La sumatoria de todas las piezas de todos los pedidos del folio"
              >
                TPZ
              </th>
              <th title="Observaciones">OBS</th>
              <th title="Porcentaje de progreso del folio.">%PRO</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="folios">
              <ng-container *ngFor="let folio of folios">
                <tr
                  *ngFor="
                    let pedido of verComoPedidos
                      ? folio.folioLineas
                      : [folio.folioLineas]
                  "
                >
                  <td class="fit">
                    <a
                      (click)="folioParaDetalle = folio"
                      [ngClass]="{
                        'btn-warning': folio.impreso,
                        'btn-outline-warning': !folio.impreso
                      }"
                      class="btn   btn-xs mr-1"
                      data-toggle="modal"
                      data-target="#imprimirOrdenesDePedido"
                    >
                      <i class="fas fa-print"></i>
                    </a>

                    <a
                      *ngIf="!verComoPedidos"
                      (click)="folioParaDetalle = folio"
                      title="Ver detalle rapido del folio."
                      data-toggle="modal"
                      data-target="#detalleFolio"
                      name=""
                      id=""
                      class="btn btn-primary text-white btn-xs "
                      role="button"
                    >
                      <i class="fas fa-eye    "></i
                    ></a>

                    <a
                      *ngIf="verComoPedidos"
                      (click)="pedidoParaDetalle = pedido"
                      title="Ver detalle rapido del pedido."
                      data-toggle="modal"
                      data-target="#detalleDePedido"
                      name=""
                      id=""
                      class="btn btn-primary text-white btn-xs"
                      role="button"
                    >
                      <i class="fas fa-eye    "></i
                    ></a>
                  </td>
                  <td class="fit">{{ folio.numeroDeFolio }}</td>
                  <td *ngIf="verComoPedidos" class="fit">
                    {{ pedido.pedido }}
                  </td>
                  <td>{{ folio.cliente.nombre }}</td>
                  <td>{{ folio.vendedor.nombre }}</td>
                  <td *ngIf="verComoPedidos" class="fit">
                    {{ pedido.modeloCompleto | modeloCompleto }}
                  </td>
                  <td
                    class="no-wrap"
                    title="{{
                      folio.fechaDeEntregaAProduccion | fecha: 'LLLL'
                    }}"
                  >
                    <i class="fas fa-clock-o"></i>
                    {{ folio.fechaDeEntregaAProduccion | date: "dd/MM/yy" }}
                  </td>
                  <td>
                    <ng-container *ngIf="verComoPedidos; else elseTemplate">
                      {{ pedido.cantidad | number }}
                    </ng-container>
                    <ng-template #elseTemplate>
                      {{ folio.totalDePiezas() | number }}
                    </ng-template>
                  </td>

                  <td>
                    <ng-container *ngIf="verComoPedidos">
                      <h6>
                        <strong>{{ folio.observaciones }}</strong>
                      </h6>
                      {{ pedido.observaciones }}
                    </ng-container>

                    <ng-container>
                      {{ folio.observaciones }}
                    </ng-container>
                  </td>
                  <td>


                    <ng-container
                      *ngIf="verComoPedidos; else verComoPedTemplate"
                    >
                      <app-progress-bar
                        [porcentaje]="pedido.porcentajeAvance"
                        [nivel]="pedido.nivelDeUrgencia"
                      ></app-progress-bar>
                    </ng-container>
                    <ng-template #verComoPedTemplate>
                      <app-progress-bar
                        [porcentaje]="folio.porcentajeAvance"
                        [nivel]="folio.nivelDeUrgencia"
                      ></app-progress-bar>
                    </ng-template>
                  </td>
                </tr>
              </ng-container>
            </ng-container>

            <tr *ngIf="!folios">
              <td colspan="20">
                <h1 class="display-1">
                  No hay folios <strong>pendientes</strong> de revision
                </h1>
              </td>
            </tr>
          </tbody>
        </table>

        <app-paginador *ngIf="folios" [paginador]="_paginadorService">
        </app-paginador>
      </div>
    </div>
  </div>
</div>

<!-- 
=====================================
 MODAL FOLIO DETALLE
=====================================
-->

<div
  id="no_print"
  class="modal fade"
  id="detalleFolio"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-folios-detalle-abstracto
          (pedido)="pedidoParaDetalle = $event"
          [folio]="folioParaDetalle"
        ></app-folios-detalle-abstracto>
      </div>
    </div>
  </div>
</div>
<!-- 
=====================================
 END MODAL FOLIO DETALLE
=====================================
-->

<!-- 
=====================================
 MODAL PEDIDO DETALLE
=====================================
-->
<div
  id="no_print"
  class="modal   fade  "
  id="detalleDePedido"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-pedidos-detalle
          (orden)="ordenParaDetalle = $event"
          [pedido]="pedidoParaDetalle"
        ></app-pedidos-detalle>
      </div>
    </div>
  </div>
</div>
<!-- 
=====================================
 END MODAL PEDIDO DETALLE
=====================================
-->

<!-- 
=====================================
 MODAL ORDEN DETALLE
=====================================
-->
<div
  id="no_print"
  class="modal   fade "
  id="detalleDeLaOrden"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-ordenes-detalle
          [folio]="folioParaDetalle"
          [linea]="pedidoParaDetalle"
          [orden]="ordenParaDetalle"
        ></app-ordenes-detalle>
      </div>
    </div>
  </div>
</div>

<!-- 
=====================================
 END MODAL ORDEN DETALLE
=====================================
-->

<!-- 
=====================================
 MODAL FOLIO EDICION
=====================================
-->
<div
  class="modal fade"
  id="modalFolioEdicion"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <app-folios-crear-modificar-abstracto
          #componenteModificar
        ></app-folios-crear-modificar-abstracto>
      </div>
    </div>
  </div>
</div>
<!-- 
=====================================
 END MODAL FOLIO EDICION
=====================================
-->

<!-- 
=====================================
 Imprimir ordenes del folio.
=====================================
-->

<!-- Button trigger modal -->

<!-- Modal -->
<div
  class="modal fade"
  id="imprimirOrdenesDePedido"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modelTitleId"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Imprimir ordenes</h5>
      </div>
      <div class="modal-body" *ngIf="folioParaDetalle">
        <div class="row">
          <div class="col-12">
            <div class="w-100" id="print-ordenes-de-folio">
              <ng-container *ngFor="let pedido of folioParaDetalle.folioLineas">
                <h2 class="no-print">
                  <small>PED: </small> {{ pedido.pedido }}
                </h2>

                <app-ordenes-detalle
                  *ngFor="let orden of pedido.ordenes"
                  [orden]="orden"
                  [folio]="folioParaDetalle"
                  [linea]="pedido"
                >
                </app-ordenes-detalle>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <app-boton-para-imprecion
          (click)="marcarImpreso()"
          [id]="'print-ordenes-de-folio'"
        ></app-boton-para-imprecion>
      </div>
    </div>
  </div>
</div>

<!-- 
  =====================================
   END Imprimir ordenes del folio.
  =====================================
  -->
